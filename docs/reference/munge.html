<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Apply a list of mungepieces to data. — munge • mungebits2</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mungebits2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Apply a list of mungepieces to data.</h1>
    </div>

    
    <p>The <code>munge</code> function allows a convenient format for applying a 
sequence of <code><a href='mungepiece.html'>mungepiece</a></code> objects to a dataset.</p>
    

    <pre class="usage"><span class='fu'>munge</span>(<span class='no'>data</span>, <span class='no'>mungelist</span>, <span class='kw'>stagerunner</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>list</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>parse</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>data.frame. Raw, uncleaned data.</p></td>
    </tr>
    <tr>
      <th>mungelist</th>
      <td><p>list. A list of lists which will be translated to a
list of mungepieces. It is also possible to pass a list of mungepieces,
but often the special syntax is more convenient. See the examples section.</p></td>
    </tr>
    <tr>
      <th>stagerunner</th>
      <td><p>logical or list. Either <code>TRUE</code> or <code>FALSE</code>, by default
   the latter. If <code>TRUE</code>, a <code><a href='http://www.rdocumentation.org/packages/stagerunner/topics/stagerunner'>stagerunner</a></code>
   object will be returned whose context will contain a key <code>data</code>
   after being ran, namely the munged data set (with a "mungepieces"
   attribute).</p>
<p>One can also provide a list with a <code>remember</code> parameter,
   which will be used to construct a stagerunner with the same value
   for its <code>remember</code> parameter.</p></td>
    </tr>
    <tr>
      <th>list</th>
      <td><p>logical. Whether or not to return the list of mungepieces
instead of executing them on the <code>data</code>. By default <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>parse</th>
      <td><p>logical. Whether or not to pre-parse the <code>mungelist</code>
using <code><a href='parse_mungepiece.html'>parse_mungepiece</a></code>. Note that if this is <code>TRUE</code>,
any trained mungepieces will be duplicated and marked as untrained.
By default, <code>TRUE</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A cleaned <code>data.frame</code>, the result of applying each
   <code><a href='mungepiece.html'>mungepiece</a></code> constructed from the <code>mungelist</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>munge</code> helper accepts a raw, pre-munged (pre-cleaned)
dataset and a list of lists. Each sublist represents the code
and hyperparameters necessary to clean the dataset. For example,
the first row could consist of an imputation function and a list
of variables to apply the imputation to. It is important to
understand what a <code><a href='mungebit.html'>mungebit</a></code> and <code><a href='mungepiece.html'>mungepiece</a></code>
does before using the <code>munge</code> helper, as it constructs these
objects on-the-fly for its operation.</p>
<p>The end result of calling <code>munge</code> is a fully cleaned data set
(i.e., one to whom all the mungepieces have been applied and trained)
adjoined with a <code>"mungepieces"</code> attribute: the list of trained
mungepieces.</p>
<p>For each sublist in the list of pre-mungepieces passed to <code>munge</code>,
the following format is available. See the examples for a more hands-on
example.</p><ol>
<li><p><code>list(train_fn, ...)</code> -- If the first element of <code>args</code> is
    a function followed by other arguments, the constructed mungepiece
    will use the <code>train_fn</code> as both the <em>train and predict</em>
    function for the mungebit, and <code>list(...)</code> (that is, the remaining 
    elements in the list) will be used as both the train and predict
    arguments in the mungepiece. In other words, using this format
    specifies you would like <em>exactly the same behavior in
    training as in prediction</em>. This is appropriate for mungebits
    that operate in place and do not need information obtained
    from the training set, such as simple value replacement or
    column removal.</p></li>
<li><p><code>list(list(train_fn, predict_fn), ...)</code>
    -- If <code>args</code> consists of a two-element pair in its first
    element, it must be a pair of either <code>NULL</code>s or functions,
    with not both elements <code>NULL</code>. If the <code>train_fn</code>
    or <code>predict_fn</code>, resp., is <code>NULL</code>, this will signify to have
    <em>no effect</em> during training or prediction, resp.
    The remaining arguments, that is <code>list(...)</code>, will be used
    as both the training and prediction arguments.
    This structure is ideal if the behavior during training and prediction
    has an identical parametrization but very different implementation,
    such as imputation, so you can pass two different functions.
    It is also useful if you wish to have no effect during prediction,
    such as removing faulty rows during training, or no effect during
    training, such as making a few transformations that are only
    necessary on raw production data rather than the training data.</p></li>
<li><p><code>list(train = list(train_fn, ...), predict = list(predict_fn, ...))</code>
    If <code>args</code> consists of a list consisting of exactly two named
    elements with names "train" and "predict", then the first format will be
    used for the respective fields. In other words, a mungepiece will
    be constructed consisting of a mungebit with <code>train_fn</code> as the
    training function, <code>predict_fn</code> as the predict fuction, and
    the mungepiece train arguments will be the train list of additional
    arguments <code>list(...)</code>, and similarly the predict arguments will be
    the predict list of additional arguments <code>list(...)</code>.
    Note <code>train_fn</code> and <code>predict_fn</code> must <em>both</em> be functions
    and not <code>NULL</code>, since then we could simply use the second format
    described above.
    This format is ideal when the parametrization differs during training and
    prediction. In this case, <code>train_fn</code> usually should be the same
    as <code>predict_fn</code>, but the additional arguments in each list can
    be used to identify the parametrized discrepancies. For example, to
    sanitize a dataset one may wish to drop unnecessary variables. During
    training, this excludes the dependent variable, but during prediction
    we may wish to drop the dependent as well.
    This format can also be used to perform totally different behavior on
    the dataset during training and prediction (different functions and
    parameters), but mungebits should by definition achieve the same
    operation during training and prediction, so this use case is rare
    and should be handled carefully.</p></li>
</ol>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='mungebit.html'>mungebit</a></code>, <code><a href='mungepiece.html'>mungepiece</a></code>,
   <code><a href='parse_mungepiece.html'>parse_mungepiece</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># First, we show off the various formats that the parse_mungepiece</span>
<span class='co'># helper accepts. For this exercise, we can use dummy train and</span>
<span class='co'># predict functions and arguments.</span>
<span class='no'>train_fn</span>   <span class='kw'>&lt;-</span> <span class='no'>predict_fn</span>   <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>...</span>) { <span class='no'>x</span> }
<span class='no'>train_arg1</span> <span class='kw'>&lt;-</span> <span class='no'>predict_arg1</span> <span class='kw'>&lt;-</span> <span class='no'>dual_arg1</span> <span class='kw'>&lt;-</span> <span class='fl'>TRUE</span> <span class='co'># Can be any parameter value.</span>

<span class='co'># The typical way to construct mungepieces would be using the constructor.</span>
<span class='no'>piece</span> <span class='kw'>&lt;-</span> <span class='no'>mungepiece</span>$<span class='fu'>new</span>(
  <span class='no'>mungebit</span>$<span class='fu'>new</span>(<span class='no'>train_fn</span>, <span class='no'>predict_fn</span>),
  <span class='fu'>list</span>(<span class='no'>train_arg1</span>), <span class='fu'>list</span>(<span class='no'>predict_arg1</span>)
)

<span class='co'># This is tedious and can be simplified with the munge syntax, which</span>
<span class='co'># allows one to specify a nested list that defines all the mungebits</span>
<span class='co'># and enclosing mungepieces at once.</span>

<span class='no'>raw_data</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>
<span class='no'>munged_data</span> <span class='kw'>&lt;-</span> <span class='fu'>munge</span>(<span class='no'>raw_data</span>, <span class='fu'>list</span>(
  <span class='co'># If the train function with train args is the same as the predict function</span>
  <span class='co'># with predict args, we use this syntax. The first element should be</span>
  <span class='co'># the funtion we use for both training and prediction. The remaining</span>
  <span class='co'># arguments will be used as both the `train_args` and `predict_args`</span>
  <span class='co'># for the resulting mungepiece.</span>
  <span class='st'>"Same train and predict"</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>train_fn</span>, <span class='no'>train_arg1</span>, <span class='kw'>train_arg2</span> <span class='kw'>=</span> <span class='st'>"blah"</span>),

  <span class='co'># If the train and predict arguments to the mungepiece match, but we</span>
  <span class='co'># wish to use a different train versus predict function for the mungebit.</span>
  <span class='st'>"Different functions, same args"</span> <span class='kw'>=</span>
    <span class='fu'>list</span>(<span class='fu'>list</span>(<span class='no'>train_fn</span>, <span class='no'>predict_fn</span>), <span class='no'>dual_arg1</span>, <span class='kw'>dual_arg2</span> <span class='kw'>=</span> <span class='st'>"blah"</span>),

  <span class='co'># If we wish to only run this mungepiece during training.</span>
  <span class='st'>"Only run in train"</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>list</span>(<span class='no'>train_fn</span>, <span class='kw'>NULL</span>), <span class='no'>train_arg1</span>, <span class='kw'>train_arg2</span> <span class='kw'>=</span> <span class='st'>"blah"</span>),

  <span class='co'># If we wish to only run this mungepiece during prediction.</span>
  <span class='st'>"Only run in predict"</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>list</span>(<span class='kw'>NULL</span>, <span class='no'>predict_fn</span>), <span class='no'>predict_arg1</span>, <span class='kw'>predict_arg2</span> <span class='kw'>=</span> <span class='st'>"blah"</span>),

  <span class='co'># If we wish to run different arguments but the same function during</span>
  <span class='co'># training versus prediction.</span>
  <span class='st'>"Totally different train and predict args, but same functions"</span> <span class='kw'>=</span>
     <span class='fu'>list</span>(<span class='kw'>train</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>train_fn</span>, <span class='no'>train_arg1</span>),
          <span class='kw'>predict</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>train_fn</span>, <span class='no'>predict_arg1</span>)),

  <span class='co'># If we wish to run different arguments with different functions during</span>
  <span class='co'># training versus prediction.</span>
  <span class='st'>"Totally different train and predict function and args"</span> <span class='kw'>=</span>
    <span class='fu'>list</span>(<span class='kw'>train</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>train_fn</span>, <span class='no'>train_arg1</span>),
                      <span class='kw'>predict</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>predict_fn</span>, <span class='no'>predict_arg1</span>))
)) <span class='co'># End the call to munge()</span>

<span class='co'># This is an abstract example that was purely meant to illustrate syntax</span>
<span class='co'># The munged_data variable will have the transformed data set along</span>
<span class='co'># with a "mungepieces" attribute recording a list of trained mungepieces</span>
<span class='co'># derived from the above syntax.</span>

<span class='co'># A slightly more real-life example.</span>
<span class='fu'>not_run</span>({
  <span class='no'>munged_data</span> <span class='kw'>&lt;-</span> <span class='fu'>munge</span>(<span class='no'>raw_data</span>, <span class='fu'>list</span>(
    <span class='st'>"Drop useless vars"</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>list</span>(<span class='no'>drop_vars</span>, <span class='no'>vector_of_variables</span>),
                               <span class='fu'>list</span>(<span class='no'>drop_vars</span>, <span class='fu'>c</span>(<span class='no'>vector_variables</span>, <span class='st'>"dep_var"</span>))),
    <span class='st'>"Impute variables"</span>  <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>imputer</span>, <span class='no'>imputed_vars</span>),
    <span class='st'>"Discretize vars"</span>   <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>list</span>(<span class='no'>discretize</span>, <span class='no'>restore_levels</span>), <span class='no'>discretized_vars</span>)
  ))

  <span class='co'># Here, we have requested to munge the raw_data by dropping useless variables,</span>
  <span class='co'># including the dependent variable dep_var after model training,</span>
  <span class='co'># imputing a static list of imputed_vars, discretizing a static list</span>
  <span class='co'># of discretized_vars being careful to use separate logic when merely</span>
  <span class='co'># using the computed discretization cuts to bin the numeric features into</span>
  <span class='co'># categorical features. The end result is a munged_data set with an </span>
  <span class='co'># attribute "mungepieces" that holds the list of mungepieces used for</span>
  <span class='co'># munging the data, and can be used to perform the exact same set of</span>
  <span class='co'># operations on a single row dataset coming through in a real-time production</span>
  <span class='co'># system.</span>
  <span class='no'>munged_single_row_of_data</span> <span class='kw'>&lt;-</span> <span class='fu'>munge</span>(<span class='no'>single_row_raw_data</span>, <span class='no'>munged_data</span>)
})
<span class='co'># The munge function uses the attached "mungepieces" attribute, a list of</span>
<span class='co'># trained mungepieces.</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Robert Krzyzanowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
